<div class="sidebar ">

    {% if page.tags.size == 1 %}
      <h2>Related By Tag</h2>
    {% elsif page.tags.size > 1 %}
      <h2>Related By Tags</h2>
    {% endif %}
  
    <ul>
      {% assign posts = site.posts | sort: 'title' %}
      {% for post in posts %}
        {% assign isAdded = false %}
        {% for tagAll in post.tags %}
          {% for tag in page.tags %}
            {% if tagAll == tag and page.title != post.title and isAdded == false %}
              <li><a href="{{ post.url | prepend: site.url }}">{{ post.title }}</a></li>
              {% assign isAdded = true %}
            {% endif %}
          {% endfor %}
        {% endfor %}
      {% endfor %}
    </ul>
  </div>
  
  <div class="sidebar">
    <h2><i class="fa fa-tags"></i> Tags</h2>
    <ul>
      {% assign tags = (site.tags | sort:0) %}
      {% for tag in tags %}
      {% if tag[1].size > 1 %}
        <li>
            {% assign tagLink = '/tag/' | append: tag[0] | append: '.html' %}
          <a href="{{ tagLink | relative_url }}" title="{{ tag[1].size }}">
            <span class="tag tag-{{ tag[0] }}">#{{ tag[0] }}</a></span></a></li>
      {% endif %}
      {% endfor %}
    </ul>
  </div>
  